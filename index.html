<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Cycle Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }
  </style>
</head>
<body class="bg-gray-800 flex items-center justify-center min-h-screen p-4">
  <div class="bg-gray-900 rounded-2xl shadow-lg p-6 w-full max-w-md">
    <h1 class="text-3xl font-semibold text-center mb-2 text-gray-100">Cycle Calculator</h1>
    <p class="text-center text-gray-400 mb-6">Calculate your optimal bedtime or wake-up time based on sleep cycles.</p>

    <div class="flex space-x-2 mb-6">
      <button id="bedtimeBtn" class="flex-1 py-2 rounded">Bedtime</button>
      <button id="wakeBtn" class="flex-1 py-2 rounded">Wake-up time</button>
    </div>

    <div class="flex justify-center items-center mb-6 space-x-2">
      <input id="hourInput" type="number" min="1" max="12" value="10"
             class="w-16 h-16 bg-gray-700 border border-gray-600 rounded-lg text-4xl text-center text-gray-200 focus:outline-none"/>
      <div class="text-4xl text-gray-400">:</div>
      <input id="minuteInput" type="number" min="0" max="59" value="00"
             class="w-16 h-16 bg-gray-700 border border-gray-600 rounded-lg text-4xl text-center text-gray-200 focus:outline-none"/>
      <div class="flex flex-col border border-gray-600 rounded-lg overflow-hidden">
        <button id="amBtn" class="px-3 py-1">AM</button>
        <button id="pmBtn" class="px-3 py-1">PM</button>
      </div>
    </div>

    <div class="mb-2">
      <label class="block text-gray-300 mb-1">Cycles: <span id="cycleLabel" class="font-medium text-gray-100">5</span></label>
      <input id="cycleRange" type="range" min="1" max="10" value="5" class="w-full h-2 bg-indigo-600 rounded-lg appearance-none cursor-pointer"/>
    </div>
    <div class="text-gray-400 italic text-sm mb-6">Recommended cycles: 4–6</div>

    <button id="calculateBtn" class="w-full py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow hover:bg-indigo-700 transition-colors">
      Calculate
    </button>

    <ul id="resultList" class="mt-4 space-y-4 text-gray-100"></ul>
  </div>

  <script>
    const CYCLE_MIN = 90 * 60000, CYCLE_MAX = 120 * 60000,
          ACTIVE = 'bg-indigo-600 text-white', INACTIVE = 'bg-gray-700 text-gray-300';

    // DOM elements
    const els = {
      bedtimeBtn: document.getElementById('bedtimeBtn'),
      wakeBtn: document.getElementById('wakeBtn'),
      hourInput: document.getElementById('hourInput'),
      minuteInput: document.getElementById('minuteInput'),
      amBtn: document.getElementById('amBtn'),
      pmBtn: document.getElementById('pmBtn'),
      cycleRange: document.getElementById('cycleRange'),
      cycleLabel: document.getElementById('cycleLabel'),
      calculateBtn: document.getElementById('calculateBtn'),
      resultList: document.getElementById('resultList')
    };

    let mode = 'wake', period = 'AM';

    // Toggle helpers
    const setToggle = (on, off) => {
      on.className = `flex-1 py-2 rounded ${ACTIVE}`;
      off.className = `flex-1 py-2 rounded ${INACTIVE}`;
    };
    const setPeriod = (on, off) => {
      on.className = `px-3 py-1 ${ACTIVE}`;
      off.className = `px-3 py-1 ${INACTIVE}`;
    };

    // Initialize toggles
    els.bedtimeBtn.onclick = () => { mode = 'sleep'; setToggle(els.bedtimeBtn, els.wakeBtn); };
    els.wakeBtn.onclick = () => { mode = 'wake'; setToggle(els.wakeBtn, els.bedtimeBtn); };
    setToggle(els.wakeBtn, els.bedtimeBtn);

    els.amBtn.onclick = () => { period = 'AM'; setPeriod(els.amBtn, els.pmBtn); };
    els.pmBtn.onclick = () => { period = 'PM'; setPeriod(els.pmBtn, els.amBtn); };
    setPeriod(els.amBtn, els.pmBtn);

    // Input handlers
    els.hourInput.oninput = () => {
      els.hourInput.value = Math.min(12, Math.max(1, +els.hourInput.value || 1));
      if (els.hourInput.value.length > 1) els.minuteInput.focus();
    };
    els.minuteInput.oninput = () => {
      els.minuteInput.value = String(Math.min(59, Math.max(0, +els.minuteInput.value || 0))).padStart(2, '0');
    };
    els.hourInput.onfocus = () => els.hourInput.select();
    els.minuteInput.onfocus = () => els.minuteInput.select();

    // Sync cycle label with range input
    els.cycleRange.oninput = () => els.cycleLabel.textContent = els.cycleRange.value;

    // Calculate and render results
    els.calculateBtn.onclick = () => {
      const h12 = +els.hourInput.value,
            m = +els.minuteInput.value,
            h24 = (h12 % 12) + (period === 'PM' ? 12 : 0),
            baseMs = new Date(1970, 0, 1, h24, m).getTime(),
            cycles = +els.cycleRange.value,
            sign = mode === 'sleep' ? 1 : -1,
            label = mode === 'sleep' ? 'Wake-up time' : 'Bedtime';

      // Calculate times
      const minMs = baseMs + sign * cycles * CYCLE_MIN,
            maxMs = baseMs + sign * cycles * CYCLE_MAX,
            optimalMs = (minMs + maxMs) / 2,
            minTime = new Date(minMs).toLocaleTimeString([], {hour: 'numeric', minute: '2-digit'}),
            optimalTime = new Date(optimalMs).toLocaleTimeString([], {hour: 'numeric', minute: '2-digit'});

      // Display results
      els.resultList.innerHTML = `
        <li class="bg-indigo-700 p-3 rounded text-center">
          ${label}: <span class="font-medium">${minTime}</span>
        </li>
        <li class="text-gray-400 px-3 text-center">
          However, based on the midpoint of 90–120 min cycles, your optimal ${label.toLowerCase()} would be
          <span class="font-medium">${optimalTime}</span>, which best aligns with lighter sleep phases.
        </li>`;
    };
  </script>
</body>
</html>
