<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Cycle Calculator</title>

  <!-- Favicon & PWA manifest -->
  <link rel="shortcut icon" href="/favicon.png" type="image/png">
  <link rel="icon" sizes="192x192" href="/favicon-192.png" type="image/png">
  <link rel="apple-touch-icon" href="/favicon-192.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#6366F1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Cycle Calculator">

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0 }
    input[type=number] { -moz-appearance: textfield }
  </style>
</head>
<body class="bg-gray-800 flex items-center justify-center min-h-screen p-4">
  <div class="bg-gray-900 rounded-2xl shadow-lg p-6 w-full max-w-md">
    <h1 class="text-3xl font-semibold text-center mb-2 text-gray-100">Cycle Calculator</h1>
    <p class="text-center text-gray-400 mb-6 text-sm">Calculate your optimal bedtime or wake-up time based on sleep cycles.</p>

    <!-- mode buttons -->
    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mb-6">
      <button id="bedtimeBtn" class="flex-1 py-2 rounded">Bedtime</button>
      <button id="wakeBtn" class="flex-1 py-2 rounded">Wake-up time</button>
    </div>

    <!-- time picker -->
    <div class="flex flex-wrap flex-row items-center justify-center space-x-2 space-y-2 mb-6">
      <input id="hourInput" type="number" min="1" max="12" value="10"
        class="w-12 sm:w-16 h-16 bg-gray-700 border border-gray-600 rounded-lg text-3xl sm:text-4xl text-center text-gray-200 focus:outline-none"/>
      <div class="w-12 sm:w-16 h-16 flex items-center justify-center text-3xl sm:text-4xl text-gray-400">
        :
      </div>
      <input id="minuteInput" type="number" min="0" max="59" value="00"
        class="w-12 sm:w-16 h-16 bg-gray-700 border border-gray-600 rounded-lg text-3xl sm:text-4xl text-center text-gray-200 focus:outline-none"/>
      <div class="flex flex-row sm:flex-col border border-gray-600 rounded-lg overflow-hidden">
        <button id="amBtn" class="px-2 sm:px-3 py-1">AM</button>
        <button id="pmBtn" class="px-2 sm:px-3 py-1">PM</button>
      </div>
    </div>

    <!-- cycles -->
    <div class="mb-2">
      <label class="block text-gray-300 mb-1 text-sm">
        Cycles: <span id="cycleLabel" class="font-medium text-gray-100">5</span>
      </label>
      <input id="cycleRange" type="range" min="1" max="10" value="5"
        class="w-full h-2 bg-indigo-600 rounded-lg appearance-none cursor-pointer"/>
    </div>
    <div class="text-gray-400 italic text-xs mb-6">Recommended cycles: 4–6</div>

    <!-- calculate -->
    <button id="calculateBtn"
      class="w-full py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow hover:bg-indigo-700 transition-colors">
      Calculate
    </button>

    <!-- results -->
    <ul id="resultList" class="mt-4 space-y-4 text-gray-100 text-sm"></ul>
  </div>

  <!-- version badge -->
  <div class="fixed bottom-2 left-2 text-xs text-gray-400">v1.0.0</div>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(console.error);
    }

    const CYCLE_MIN = 90*60000, CYCLE_MAX = 120*60000,
          ACTIVE = 'bg-indigo-600 text-white', INACTIVE = 'bg-gray-700 text-gray-300';

    const els = {
      bedtimeBtn: document.getElementById('bedtimeBtn'),
      wakeBtn: document.getElementById('wakeBtn'),
      hourInput: document.getElementById('hourInput'),
      minuteInput: document.getElementById('minuteInput'),
      amBtn: document.getElementById('amBtn'),
      pmBtn: document.getElementById('pmBtn'),
      cycleRange: document.getElementById('cycleRange'),
      cycleLabel: document.getElementById('cycleLabel'),
      calculateBtn: document.getElementById('calculateBtn'),
      resultList: document.getElementById('resultList')
    };

    let mode = 'wake', period = 'AM';
    const setToggle = (on, off) => {
      on.className = `flex-1 py-2 rounded ${ACTIVE}`;
      off.className = `flex-1 py-2 rounded ${INACTIVE}`;
    };
    const setPeriod = (on, off) => {
      on.className = `px-2 sm:px-3 py-1 ${ACTIVE}`;
      off.className = `px-2 sm:px-3 py-1 ${INACTIVE}`;
    };

    els.bedtimeBtn.onclick = () => { mode = 'sleep'; setToggle(els.bedtimeBtn, els.wakeBtn); };
    els.wakeBtn.onclick = () => { mode = 'wake'; setToggle(els.wakeBtn, els.bedtimeBtn); };
    setToggle(els.wakeBtn, els.bedtimeBtn);

    els.amBtn.onclick = () => { period = 'AM'; setPeriod(els.amBtn, els.pmBtn); };
    els.pmBtn.onclick = () => { period = 'PM'; setPeriod(els.pmBtn, els.amBtn); };
    setPeriod(els.amBtn, els.pmBtn);

    els.hourInput.oninput = () => {
      let v = Math.min(12, Math.max(1, +els.hourInput.value || 1));
      els.hourInput.value = v;
      if (els.hourInput.value.length > 1) els.minuteInput.focus();
    };
    els.minuteInput.oninput = () => {
      let v = Math.min(59, Math.max(0, +els.minuteInput.value || 0));
      els.minuteInput.value = String(v).padStart(2, '0');
    };
    els.hourInput.onfocus = () => els.hourInput.select();
    els.minuteInput.onfocus = () => els.minuteInput.select();

    els.cycleRange.oninput = () => els.cycleLabel.textContent = els.cycleRange.value;

    els.calculateBtn.onclick = () => {
      const h12 = +els.hourInput.value,
            m = +els.minuteInput.value,
            h24 = (h12 % 12) + (period === 'PM' ? 12 : 0),
            baseMs = new Date(1970, 0, 1, h24, m).getTime(),
            n = +els.cycleRange.value,
            sgn = mode === 'sleep' ? 1 : -1;

      const minT = new Date(baseMs + sgn * n * CYCLE_MIN)
                     .toLocaleTimeString([], {hour:'numeric',minute:'2-digit'}),
            optT = new Date((baseMs + sgn*n*CYCLE_MIN + baseMs + sgn*n*CYCLE_MAX)/2)
                     .toLocaleTimeString([], {hour:'numeric',minute:'2-digit'}),
            lbl = mode==='sleep'?'Wake-up time':'Bedtime';

      els.resultList.innerHTML = `
        <li class="bg-indigo-700 p-3 rounded text-center">
          ${lbl}: <span class="font-medium">${minT}</span>
        </li>
        <li class="text-gray-400 px-3 text-center">
          However, based on the midpoint of 90–120 min cycles, your optimal ${lbl.toLowerCase()} would be
          <span class="font-medium">${optT}</span>, which best aligns with lighter sleep phases.
        </li>`;
    };
  </script>
</body>
</html>
